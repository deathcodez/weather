<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Nested Div Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      gap: 20px;
      padding: 20px;
    }

    .canvas {
      width: 600px;
      height: 400px;
      border: 2px dashed #aaa;
      position: relative;
      overflow: hidden;
      background: #fafafa;
    }

    .box {
      width: 120px;
      height: 120px;
      position: absolute;
      top: 50px;
      left: 50px;
      box-sizing: border-box;
      border: 2px solid #333;
    }

    .resize-handle {
      width: 10px;
      height: 10px;
      background: #000;
      position: absolute;
    }
    .resize-handle.n { top: -5px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
    .resize-handle.s { bottom: -5px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
    .resize-handle.e { right: -5px; top: 50%; transform: translateY(-50%); cursor: e-resize; }
    .resize-handle.w { left: -5px; top: 50%; transform: translateY(-50%); cursor: w-resize; }
    .resize-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
    .resize-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
    .resize-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
    .resize-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

    .controls {
      flex: 1;
    }

    .code-box {
      width: 100%;
      height: 300px;
      margin-top: 10px;
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #ccc;
      font-family: monospace;
      white-space: pre;
      overflow: auto;
    }

    button {
      padding: 8px 12px;
      cursor: pointer;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <!-- Canvas Area -->
  <div class="canvas" id="canvas"></div>

  <!-- Controls -->
  <div class="controls">
    <button onclick="addBox()">Add Box</button>
    <button onclick="copyCode()">Copy Code</button>
    <div class="code-box" id="codeOutput">// Your code will appear here</div>
  </div>

  <script>
    let boxCount = 0;
    const canvas = document.getElementById("canvas");
    const codeOutput = document.getElementById("codeOutput");

    function getRandomColor() {
      return `hsl(${Math.floor(Math.random()*360)}, 70%, 60%)`;
    }

    function addBox(parent = canvas) {
      const box = document.createElement("div");
      box.className = "box";
      box.id = "box" + (++boxCount);
      box.style.background = getRandomColor();
      box.style.left = "50px";
      box.style.top = "50px";

      // Add resize handles
      ["n","s","e","w","ne","nw","se","sw"].forEach(dir => {
        const handle = document.createElement("div");
        handle.className = "resize-handle " + dir;
        handle.dataset.dir = dir;
        box.appendChild(handle);
      });

      parent.appendChild(box);

      makeDraggableAndResizable(box, parent);

      // Double click â†’ add child box inside
      box.addEventListener("dblclick", (e) => {
        e.stopPropagation();
        addBox(box);
      });

      updateCode();
    }

    function makeDraggableAndResizable(box, parent) {
      let isDragging = false, resizing = false;
      let offsetX, offsetY, resizeDir;
      let startX, startY, startW, startH, startTop, startLeft;

      // Dragging
      box.addEventListener("mousedown", (e) => {
        if (!e.target.classList.contains("resize-handle")) {
          isDragging = true;
          offsetX = e.offsetX;
          offsetY = e.offsetY;
          e.stopPropagation();
        }
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          const parentRect = parent.getBoundingClientRect();
          box.style.left = (e.pageX - parentRect.left - offsetX) + "px";
          box.style.top = (e.pageY - parentRect.top - offsetY) + "px";
          updateCode();
        }

        if (resizing) {
          let dx = e.pageX - startX;
          let dy = e.pageY - startY;

          if (resizeDir.includes("e")) box.style.width = startW + dx + "px";
          if (resizeDir.includes("s")) box.style.height = startH + dy + "px";
          if (resizeDir.includes("w")) {
            box.style.width = startW - dx + "px";
            box.style.left = startLeft + dx + "px";
          }
          if (resizeDir.includes("n")) {
            box.style.height = startH - dy + "px";
            box.style.top = startTop + dy + "px";
          }
          updateCode();
        }
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
        resizing = false;
      });

      // Resizing
      box.querySelectorAll(".resize-handle").forEach(handle => {
        handle.addEventListener("mousedown", (e) => {
          resizing = true;
          resizeDir = e.target.dataset.dir;
          startX = e.pageX;
          startY = e.pageY;
          startW = box.offsetWidth;
          startH = box.offsetHeight;
          startTop = box.offsetTop;
          startLeft = box.offsetLeft;
          e.stopPropagation();
        });
      });
    }

    // Recursive code builder
    function buildCode(element, indent = 0) {
      if (!element.classList.contains("box")) return "";

      const style = `width:${element.offsetWidth}px; height:${element.offsetHeight}px; position:absolute; top:${element.style.top}; left:${element.style.left}; background:${element.style.backgroundColor};`;

      let spaces = " ".repeat(indent);
      let code = `${spaces}<div style="${style}">\n`;

      Array.from(element.children).forEach(child => {
        code += buildCode(child, indent + 2);
      });

      code += `${spaces}</div>\n`;
      return code;
    }

    function updateCode() {
      let code = "";
      document.querySelectorAll(".canvas > .box").forEach(box => {
        code += buildCode(box);
      });
      codeOutput.textContent = code.trim() || "// Add a box to start";
    }

    function copyCode() {
      navigator.clipboard.writeText(codeOutput.textContent).then(() => {
        alert("Code copied to clipboard!");
      });
    }
  </script>
</body>
</html>
